
# :tomato: Memory :tomato:

### หน่วยความจำ (Memory)
เป็นสถานที่/ตำแหน่งที่ทำหน้าที่พักข้อมูล (ตัวเลข) ในระบบคอมพิวเตอร์ ซึ่งมีบทบาทสำคัญอย่างมาก เพื่อใช้เป็นตัวกลางในการพักข้อมูลรอการประมวลผลของคอมพิวเตอร์ โดยหน่วยความจำ แบ่งออกเป็น 2 ประเภทหลัก ๆ คือ

<br>

#### (1) หน่วยความจำแบบถาวร (Non-Volatile Memory)
   * เป็นรูปแบบของหน่วยความจำที่สามารถจัดเก็บข้อมูลได้ โดยไม่ต้องอาศัยกระแสไฟฟ้า ตัวอย่างของหน่วยความจำแบบถาวร
   * เช่น หน่วยความจำแบบอ่านเท่านั้น (Read Only Memory; ROM)
#### (2) หน่วยความจำแบบชั่วคราว (Volatile Memory)
   * เป็นหน่วยความจำที่ต้องอาศัยกระแสไฟฟ้าเลี้ยง เพื่อเก็บข้อมูลภายในหน่วยความจำ ตัวอย่างของหน่วยความจำแบบชั่วคราว
   * เช่น หน่วยความจำเข้าถึงแบบสุ่ม (Random Access Memory; RAM)
<br>

> **_NOTE:_**  ยังมีหน่วยความจำประเภทอื่น ๆ ที่น่าสนใจ ได้แก่ หน่วยความจำแคช (Cache Memory) และหน่วยความจำเสมือน (Virtual Memory)

<br>

#### หน่วยความจำแคช (Cache Memory)
* เป็นหน่วยความจำที่มีความเร็วในการเข้าถึงข้อมูลสูงกว่าหน่วยความจำแบบทั่วไป ซึ่งช่วยให้หน่วยประมวลผลสามารถดึงคำสั่งไปทำงานได้เร็วมากขึ้น 
* โดยหน่วยความจำแคช เป็นหน่วยความจำที่เป็นตัวกลางระหว่าง หน่วยประมวลผล (CPU) และหน่วยความจำหลัก (Main Memory) ซึ่งจัดเก็บคำสั่งต่าง ๆ ที่ หน่วยประมวลผลมีการเรียกใช้งานบ่อย
* จึงทำให้หน่วยประมวลผลสามารถดึงรหัสคำสั่งที่มีการใช้งานบ่อยได้รวดเร็วมากขึ้น

> **_NOTE:_**  เราเรียกหน่วยความจำทั้ง 3 ประเภทข้างต้นว่า  หน่วยความจำหลัก (Main Memory) และเรียกสื่อต่าง ๆ ที่เป็นสื่อเพิ่มเติมจากหน่วยความจำหลักว่า หน่วยความจำภายนอก (External Memory)

<br>

#### หน่วยความจำภายนอก (External Memory)
* หน่วยความจำภายนอกนั้นเป็นหน่วยความจำสนับสนุนเพื่อเพิ่มความสามารถในการจัดเก็บข้อมูลของหน่วยความจำหลัก ซึ่งมีต้นทุนของอุปกรณ์ที่ต่ำกว่า
* โดยปกติแล้วหน่วยความภายนอกเป็นหน่วยความจำแบบถาวร (Non-Volatile) ซึ่งใช้สำหรับจัดเก็บข้อมูลสำหรับข้อมูลที่ต้องการเรียกใช้ในบางเวลาเท่านั้น


#### หน่วยความจำเสมือน (Virtual Memory)
* คือหน่วยความจำที่ได้รับการจัดสรรหน่วยความจำจากระบบปฏิบัติการ (OS) เพื่อสร้าง/จำลองหน่วยความจำเสมือนขึ้น
* เนื่องจากการใช้งานในสภาพแวดล้อมจริง ลำพังเพียงหน่วยความจำหลัก (Main Memory) อาจมีความสามารถในการรองรับที่ไม่เพียงพอต่อการทำงานของคอมพิวเตอร์ได้ เราจึงมีความจำเป็นต้องพึ่งพาหน่วยความจำภายนอก ที่ทำหน้าที่เป็น “หน่วยความจำเสมือน” เพิ่มเติมด้วย
* ซึ่งข้อมูลที่ถูกอ่านเขียนบนหน่วยความจำเสมือนนี้มีการจัดการโดยใช้เทคนิคต่างกันไป โดยเทคนิคการจัดการข้อมูลสำหรับการทำ Virtual Memory ทั่วไปนั้นประกอบด้วยเทคนิค “Swapping” และเทคนิค “Paging” 

<br>

##  Command(คำสั่ง) ที่เกี่ยวข้อง
1. cat /proc/meminfo
2. free
3. top และ htop
4. vmstat

<br>

---

### (1) cat /proc/meminfo
* คำสั่งแสดงรายการข้อมูลหน่วยความจำภายในระบบทั้งหทด
```
$ cat /proc/meminfo
```
* ผลลัพธ์
```
MemTotal:			2011236 kB
MemFree:			1531224 kB
MemAvailable:			1666596 kB
Buffers:			15928 	kB
Cached:				245224 	kB
SwapCached:			0 	kB
Active:				84508 	kB
Inactive:			230628 	kB
Active (anon):			1020 	kB
Inactive (anon):		60416 	kB
Active(file):			83488 	kB
Inactive(file):			170212 	kB
Unevictable:			27760 	kB
...
DirectMap4K:			69568	kB
DirectMap2M:			2027520	kB
```

#### คำสั่งเพื่อการแสดงผล หรือเพื่อการค้นหาที่เกี่ยวข้องเพิ่มเติม เพื่อช่วยกรองข้อมูลที่ต้องการ

| Command | Description |
| :----: | ----------- |
| cat /proc/meminfo \| more | คำสั่งอ่านข้อมูลโดยแสดงทีละหน้า |
| cat /proc/meminfo \| grep "topic" | คำสั่งหา topic ที่ต้องการ |

<br>

---
### (2) free
* คำสั่งแสดงข้อมูลการใช้งานและปริมาณคงเหลือของพื้นที่หน่วยความจำ และ Swap File (Virtual Memory)
```
$ free
```
* ผลลัพธ์
```
	total		used		free		shared		buff/cache	available
Mem:	2011236		190156		1531000		1080		290080		1669380
Swap:	1531224		1383396		0		1383396
```
#### ตารางแสดงความหมายของผลลัพธ์คำสั่ง free:
| Topic | Description |
| :----: | ----------- |
| total | จำนวนของหน่วยความจำที่ติดดั้ง |
| used | จำนวนของหน่วยความจำที่ใช้งาน ณ ปัจจุบัน |
| free | จำนวนของหน่วยความจำที่ไม่ถูกใช้งาน |
| shared | จำนวนของหน่วยความจำที่ใช้ร่วมกันในหลายกระบวนการทำงาน |
| buff/cache | หน่วยความจำสงวนสำหรับจัดสรรเป็น buffer และจำนวนไฟล์ที่ใช้ล่าสุดที่ถูกจัดเก็บในหน่วยความจำ |
| available | จำนวนคงเหลือของหน่วยความจำ |


#### ตัวอย่าง Option ที่ใช้ร่วมกับคำำสั่งมีดังนี้:
| Option        | Option details | Description   |
| :-----------: | -------------- | ------------- |
| -b | --bytes | แสดงผลลัพธ์ข้อมูลในหน่วยไบต์ (bytes) |
| | --kilo | แสดงผลลัพธ์ข้อมูลในหน่วยกิโลไบต์ (kilobytes) |
| | --mega | แสดงผลลัพธ์ข้อมูลในหน่วยเมกะไบต์ (megabytes) |
| -k | --kibi | แสดงผลลัพธ์ข้อมูลในหน่วยกิบิไบต์ (kibibytes) |
| -m | --mebi | แสดงผลลัพธ์ข้อมูลในหน่วยเมบิไบต์ (kibibytes) |
| -g | --gibi | แสดงผลลัพธ์ข้อมูลในหน่วยจิบิไบต์ (kibibytes) |
| -h | --human | แสดงผลลัพธ์ข้อมูลในรูปแบบที่มนุษย์อ่านได้ |

> **_เกร็ดความรู้:_** หน่วย Kilobytes และ Kibibytes มีรูปแบบการแสดงจำนวนที่แตกต่างกัน โดย Kilobytes แสดงข้อมูลในรูปจำนวน 1000 bytes ในขณะที่ Kibibytes แสดงข้อมูลในรูป 1024 bytes

<br>

---
### (3) top และ htop
* คำสั่งแสดงรายการปริมาณการใช้งานหน่วยความจำ ณ ปัจจุบัน
* การใช้คำสั่ง top หรือ htop จะช่วยให้ผู้ใช้งานสามารถติดตามและตรวจสอบกระบวนการทำงานของระบบได้
```
$ top
```
* ผลลัพธ์

![image](https://github.com/aaomprt/Host-3/assets/117189340/fe8886de-a45f-4b38-af03-d6f382b18bfd)

* อาจสามารถใช้คำสั่ง "htop" แทน top เพื่อแสดงหน้าจอการแสดงผลที่ดีขึ้น
```
$ htop
```
* ผลลัพธ์

![image](https://github.com/aaomprt/Host-3/assets/117189340/ff5ce26e-eb1a-465f-9c54-f2916ac3f9c5)

* การใช้ top หรือ htop จะช่วยให้ผู้ใช้ทราบปริมาณการใช้งานของหน่วยความจำในแต่ละกระบวนการทำงาน (PID)
<br>

---
### (4) vmstat
* คำสั่งแสดงรายการสถิติของหน่วยความจำเสมือน (Virtual Memory)
```
$ vmstat
```
* ผลลัพธ์
```
procs	----------------memory---------------	---swap---	----io----	--system--	----------------cpu---------------
r	b	swpd	free	buff	cache	si	so	bi	bo	in	cs	us	sy	id	wa	st
0	0	0	1049800	27988	763784	0	0	141	58	362	135	1	2	96	1	0
```

#### ตารางแสดงความหมายของผลลัพธ์คำสั่ง vmstat:
| Topic | Description |
| :----: | ----------- |
| r | จำนวนของกระบวนการที่รอดำเนินการ |
| b | จำนวนของกระบวนที่ uninterruptible sleep |
| swpd | จำนวนของหน่วยความจำเสมือนที่ใช้งาน |
| free | จำนวนของหน่วยความจำที่ไม่ถูกใช้งาน |
| buff | จำนวนหน่วยความจำที่ใช้เป็น buffer |
| cache | จำนวนหน่วยความจำที่ใช้เป็น cache |
| si | swap file จากดิสก์ |
| so | swap file ไปดิสก์ |
| bi | บล็อกที่ได้รับ |
| bo | บล็อกที่ส่งออก |
| in | จำนวนการขัดจังหวะ (Interrupt) |
| cs | จำนวนการสลับ/วินาที |
| us | เวลาที่ใช้ในการรันโค้ดที่ไม่ใช้ Kernel |
| sy | เวลาที่ใช้ในการรันโค้ดที่ใช้ Kernel |
| id | เวลาที่ไม่ได้ใช้งาน |
| wa | เวลาที่ใช้ในการรอ IO |
| st | เวลาที่ถูกดึงไปจากเครื่อง Virtual Machine |

#### ตัวอย่าง Option ที่ใช้ร่วมกับคำำสั่งมีดังนี้:
| Option        | Option details | Description   |
| :-----------: | -------------- | ------------- |
| -a | --active | แสดงหน่วยความจำที่กำลังทำงานอยูํ |
| -d | --disk | แสดงค่าสถิติของดิสก์ |
| -ห | --stats | แสดงค่าสถิติของตัวนับเหตุการณ์ |

